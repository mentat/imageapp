<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="author" content="Mario Fischer" />
	<link rel="stylesheet" type="text/css" href="/static/imageapp/ysr-crop.css" media="all" />
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js"></script>
	<script type="text/javascript" src="/static/imageapp/mootools-1.2.4.4-more.js"></script>
	<script type="text/javascript" src="/static/imageapp/ysr-crop.js"></script>
	<title>{{img.title}}</title>
	<script type="text/javascript">
	var ch;
	window.addEvent("domready", function() {
		ch = new CwCrop({
			minsize: {x: 95, y: 70},
			maxratio: {x: 1.5, y: 2.0},
			onCrop: function(values) {
				document.forms["crop"].elements["crop[x]"].value = values.x;
				document.forms["crop"].elements["crop[y]"].value = values.y;
				document.forms["crop"].elements["crop[w]"].value = values.w;
				document.forms["crop"].elements["crop[h]"].value = values.h;
				alert("Selected area is: " + values.x + "," + values.y + " @ " + values.w + " x " + values.h);
				/*
				Here the form should be submitted usually (instead of the alert..):
				document.forms["crop"].submit();
				*/
			}
		});
	});
	</script>
</head>

<body>
	<div id="imgouter">
		<div id="cropframe" style="background-image: url('/thumb/300/1200/{{img.key()}}')">
				<div id="draghandle"></div>
				<div id="resizeHandleXY" class="resizeHandle"></div>
				<div id="cropinfo" rel="Click to crop">
					<div title="Click to crop" id="cropbtn"></div>
					<div id="cropdims"></div>
				</div>
			</div>
		
		<div id="imglayer" style="width: {{width|default_if_none:"300"}}px; height: auto; background-image: url('/thumb/300/1200/{{img.key()}}')">
		</div>
	</div>
	
	<form name="crop" method="post" action="#">
		<p>
			<button onclick="ch.doCrop()">Crop</button>
		</p>
		<input type="hidden" name="crop[x]" value="0" />
		<input type="hidden" name="crop[y]" value="0" />
		<input type="hidden" name="crop[w]" value="0" />
		<input type="hidden" name="crop[h]" value="0" />
	</form>
</body>
</html>